name: Keep Servers Alive
on:
  schedule:
   - cron: '0 12 */10 * *' # æ¯10å¤©çš„12ï¼š00æ‰§è¡Œä¸€æ¬¡ï¼ˆç§åº“æ¯æœˆ500åˆ†é’Ÿè¿è¡Œæ—¶é•¿ï¼Œæ¯å¤©16åˆ†é’Ÿï¼‰
  workflow_dispatch: 

jobs:
  keep_servers_alive:
    runs-on: ubuntu-latest
    env:
      ACCOUNTS: >
        [
        { "SSH_USER":"ç”¨æˆ·å", "SSH_PASS":"å¯†ç ", "HOST":"ç™»å½•IPæˆ–è€…åŸŸå", "PORT":"ç«¯å£"}
        ]
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install required packages
        run: |
          sudo apt-get update
          sudo apt-get install -y sshpass curl jq

      - name: Process each account
        run: |
          run_remote_command() {
          local SSH_USER=$1
          local SSH_PASS=$2
          local HOST=${3}
          local PORT=${4}
          sshpass -p "$SSH_PASS" ssh -p "$PORT" -o StrictHostKeyChecking=no "$SSH_USER@$HOST"
           }
                 echo "*****************************************************"
                 echo "*****************************************************"
                 echo "ç”¬å“¥Githubé¡¹ç›®  ï¼šgithub.com/yonggekkk"
                 echo "ç”¬å“¥Bloggeråšå®¢ ï¼šygkkk.blogspot.com"
                 echo "ç”¬å“¥YouTubeé¢‘é“ ï¼šwww.youtube.com/@ygkkk"
                 echo "vpsæœåŠ¡å™¨è¿œç¨‹ç™»å½•è„šæœ¬ã€Githubã€‘"
                 echo "*****************************************************"
                 echo "*****************************************************"
              count=0  
           for account in $(echo "${ACCOUNTS}" | jq -c '.[]'); do
              count=$((count+1))
              SSH_USER=$(echo $account | jq -r '.SSH_USER')
              SSH_PASS=$(echo $account | jq -r '.SSH_PASS')
              HOST=$(echo $account | jq -r '.HOST')
              PORT=$(echo $account | jq -r '.PORT')
          if sshpass -p "$SSH_PASS" ssh -p "$PORT" -o StrictHostKeyChecking=no "$SSH_USER@$HOST" -q exit; then
            echo "ğŸ‰æ­å–œï¼âœ…ç¬¬ã€$countã€‘å°æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼ğŸš€æœåŠ¡å™¨åœ°å€ï¼š$HOST ï¼Œè´¦æˆ·åï¼š$SSH_USER" 
           else
            echo "===================================================="
            echo "ğŸ’¥æ¯å…·ï¼âŒç¬¬ã€$countã€‘å°æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼ğŸš€æœåŠ¡å™¨åœ°å€ï¼š$HOST ï¼Œè´¦æˆ·åï¼š$SSH_USER"
            echo "âš ï¸å¯èƒ½è´¦å·åã€å¯†ç ã€æœåŠ¡å™¨åç§°ã€ç«¯å£è¾“å…¥é”™è¯¯ï¼Œæˆ–è€…å½“å‰æœåŠ¡å™¨åœ¨ç»´æŠ¤ä¸­"  
            echo "===================================================="
           fi
            done
